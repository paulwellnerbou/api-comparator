<% 
const total = it.report.results.length;
const passed = it.report.results.filter((r) => r.differences.length === 0).length;
const failed = it.report.results.filter((r) => r.differences.length > 0).length;
const passedWithErrors = it.report.results.filter((r) => 
  r.differences.length === 0 && 
  (r.reference.statusCode >= 400 || r.target.statusCode >= 400)
).length;
const passRate = total > 0 ? ((passed / total) * 100).toFixed(1) : 0;
%>

<div class="results">
  <div class="results-header">
    <h2>ðŸ“Š Results</h2>
    <button class="download-json-btn" onclick="downloadJson()" title="Download JSON Report">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      Report as JSON
    </button>
  </div>
  
  <div class="filter-tabs">
    <button class="filter-tab active" data-filter="all" onclick="filterResults('all')">
      <span class="tab-number"><%= total %></span>
      <span class="tab-label">Total Requests</span>
    </button>
    <button class="filter-tab" data-filter="passed" onclick="filterResults('passed')">
      <span class="tab-number"><%= passed %></span>
      <span class="tab-label">Passed (<%= passRate %>%)</span>
    </button>
    <button class="filter-tab" data-filter="passed-with-errors" onclick="filterResults('passed-with-errors')">
      <span class="tab-number"><%= passedWithErrors %></span>
      <span class="tab-label">Passed with Errors</span>
    </button>
    <button class="filter-tab" data-filter="failed" onclick="filterResults('failed')">
      <span class="tab-number"><%= failed %></span>
      <span class="tab-label">Failed</span>
    </button>
  </div>
  
  <div id="results-container">
    <% for (let i = 0; i < it.report.results.length; i++) { %>
      <%~ await includeAsync('result-item.html', { result: it.report.results[i], index: i }) %>
    <% } %>
  </div>
</div>
